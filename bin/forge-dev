#!/usr/bin/env bash
# bin/forge-dev - Development mode bootstrap
#
# Uses local code from lib/ with isolated dev-home for fast iteration.
# This prevents dev work from polluting your real forge-home installation.
#
# Usage:
#   ./bin/forge-dev [command] [args...]
#   alias forge-dev='./bin/forge-dev'  # For convenience
#
set -euo pipefail

# Resolve script location (follows symlinks)
script_path="${BASH_SOURCE[0]}"
while [ -L "$script_path" ]; do
  script_dir="$(cd -P "$(dirname "$script_path")" && pwd)"
  script_path="$(readlink "$script_path")"
  [[ $script_path != /* ]] && script_path="$script_dir/$script_path"
done
script_dir="$(cd -P "$(dirname "$script_path")" && pwd)"
project_root="${script_dir}/.."

# Dev mode: use local code with isolated dev-home
export XDG_DATA_HOME="${project_root}/dev-home"
export FORGE_NODE_MODULES="${XDG_DATA_HOME}/forge/node_modules"
export NODE_PATH="${FORGE_NODE_MODULES}"

# Run local CLI directly (no install needed)
exec bun run "${project_root}/lib/cli.ts" "$@"
