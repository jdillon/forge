{"id":"forge-079","title":"Agent-friendly command introspection (help2man++)","description":"A command that generates AI-agent consumable documentation about CLI tools. Similar to `help2man` but designed for AI consumption rather than man pages.\n\n**Core idea**: Given a command, recursively discover and document all nested sub-commands with their `--help` outputs in a structured, agent-optimized format.\n\n**Use case**: AI agents can query a tool to understand how to use it (or a specific sub-command) without needing pre-existing knowledge or manual documentation.","design":"## Key Features\n\n1. **Recursive sub-command discovery** - Automatically traverse command trees (e.g., `git remote add --help`)\n2. **Structured output** - JSON/YAML format optimized for LLM consumption\n3. **Option parsing** - Extract flags, arguments, defaults, types\n4. **Examples extraction** - Pull usage examples from help text\n5. **Semantic grouping** - Group related options/commands\n\n## Output Format Considerations\n\n- Machine-readable (JSON/YAML)\n- Include command hierarchy/tree structure\n- Normalize option descriptions\n- Flag required vs optional\n- Show argument types and defaults\n- Include usage patterns\n\n## Potential Approaches\n\n1. **Static analysis** - Parse `--help` output heuristically\n2. **Convention-based** - Support common CLI frameworks (Click, Cobra, yargs, etc.)\n3. **Interactive probing** - Try sub-commands to discover structure\n4. **Hybrid** - Combine approaches based on detection\n\n## Prior Art\n\n- `help2man` - Generates man pages from `--help`\n- `docopt` - Derives CLI from docstrings\n- Various shell completion generators","acceptance_criteria":"- [ ] Can introspect a simple command with `--help`\n- [ ] Can recursively discover nested sub-commands\n- [ ] Outputs structured JSON/YAML format\n- [ ] Handles common CLI patterns (flags, positional args, sub-commands)\n- [ ] Output is validated as useful by testing with an AI agent\n- [ ] Documented with examples","status":"open","priority":2,"issue_type":"epic","created_at":"2025-11-26T02:21:05.858242-08:00","updated_at":"2025-11-26T02:21:05.858242-08:00"}
{"id":"forge-3ng","title":"Make forge and homebrew-planet57 repos public","description":"Both repositories are currently private on GitHub. Need to make them public for:\n- Users to install via `brew tap jdillon/planet57`\n- Open source distribution\n\n**Repos**:\n- `github.com/jdillon/forge`\n- `github.com/jdillon/homebrew-planet57`","acceptance_criteria":"- [ ] jdillon/forge is public\n- [ ] jdillon/homebrew-planet57 is public\n- [ ] Verify `brew tap jdillon/planet57` works from external machine","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-26T02:26:01.006523-08:00","updated_at":"2025-11-27T00:37:48.595259-08:00","closed_at":"2025-11-27T00:37:48.595259-08:00"}
{"id":"forge-97e","title":"GitHub CI automation (build, test, release)","description":"Set up GitHub Actions for CI/CD:\n- Build and test on PR/push\n- Release workflow on tag push\n- Homebrew formula update automation\n\nRelated: forge-kxw (Homebrew automation details)","design":"## Workflows\n\n### 1. ci.yml - Build \u0026 Test\nTriggers: push to main, pull requests\n\n```yaml\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: oven-sh/setup-bun@v2\n      - run: bun install\n      - run: bun test\n```\n\n### 2. release.yml - Release \u0026 Homebrew Update\nTriggers: tag push (v*)\n\n```yaml\njobs:\n  release:\n    steps:\n      - Build tarball (bun run pack)\n      - Create GitHub release with tarball\n      \n  update-homebrew:\n    needs: release\n    steps:\n      - Download tarball, compute sha256\n      - Generate formula from template\n      - Push to homebrew-planet57\n```\n\n## Secrets Required\n- `HOMEBREW_TAP_TOKEN`: PAT with repo scope for tap repo","acceptance_criteria":"- [ ] ci.yml runs tests on PR and push to main\n- [ ] release.yml creates GitHub release on tag\n- [ ] release.yml updates Homebrew formula automatically\n- [ ] Tests pass in CI environment","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-26T15:46:49.200094-08:00","updated_at":"2025-11-27T01:14:15.03316-08:00","closed_at":"2025-11-27T01:14:15.03316-08:00"}
{"id":"forge-e9g","title":"Homebrew tap distribution for Forge","description":"Enable `brew tap jdillon/forge \u0026\u0026 brew install forge` for macOS/Linux users.\n\n**Investigation complete** - see `sandbox/brew-tap-investigation/`\n\n**Chosen approach**: Bun runtime dependency (Approach A)\n- Requires `depends_on \"bun\"` in formula\n- Most similar to current install.sh behavior\n- Can migrate to standalone binary later (Approach B)","design":"## Architecture\n\n**Two separate directories**:\n- `FORGE_INSTALL` - Where core code lives (Cellar for Homebrew, FORGE_HOME for manual)\n- `FORGE_HOME` - User data (`~/.forge`) - config, state, cache, logs, plugins\n\n**Key code changes needed**:\n1. Make `bin/forge` detect Homebrew vs manual install\n2. Separate \"installation directory\" from \"user data directory\"\n3. Handle case where `FORGE_HOME` doesn't exist yet\n\n## Deliverables\n\n1. **homebrew-forge repository** - github.com/jdillon/homebrew-forge\n   - `Formula/forge.rb` - Main formula\n   - `README.md` - Installation instructions\n\n2. **Forge code changes**:\n   - Make FORGE_HOME configurable\n   - Support FORGE_INSTALL for core installation path\n\n3. **Release process**:\n   - Tag release → GitHub creates tarball\n   - Compute SHA256\n   - Update formula with URL + hash\n   - (Optional) GH Action to automate\n\n## Example Formula (Approach A)\n\n```ruby\nclass Forge \u003c Formula\n  desc \"Modern CLI framework for deployments\"\n  homepage \"https://github.com/jdillon/forge\"\n  url \"https://github.com/jdillon/forge/archive/refs/tags/v1.0.0.tar.gz\"\n  sha256 \"...\"\n  depends_on \"bun\"\n\n  def install\n    system \"bun\", \"install\", \"--production\"\n    libexec.install Dir[\"*\"]\n    (bin/\"forge\").write_env_script libexec/\"bin/forge\", FORGE_HOME: libexec\n  end\nend\n```","acceptance_criteria":"- [ ] `bin/forge` supports FORGE_INSTALL for Homebrew installation\n- [ ] `homebrew-forge` repository created\n- [ ] Formula installs and runs correctly\n- [ ] `brew tap jdillon/forge \u0026\u0026 brew install forge` works\n- [ ] `forge --version` and `forge --help` work\n- [ ] User data persists in `~/.forge`\n- [ ] `brew upgrade forge` works\n- [ ] `brew uninstall forge` cleanly removes (preserves user data)\n- [ ] Works on Apple Silicon and Intel Macs\n- [ ] Documentation updated in Forge README","notes":"## Work completed\n\n**Investigation** (2025-11-15):\n- Researched Homebrew tap mechanics\n- Analyzed 3 approaches (Bun dep, standalone binary, shell script)\n- Recommended Approach A (Bun dependency)\n- Documented FORGE_HOME conflict and resolution\n- Created implementation roadmap\n\n**Artifacts**:\n- `sandbox/brew-tap-investigation/README.md` - Full investigation\n- `sandbox/brew-tap-investigation/findings.md` - Key insights\n- `sandbox/brew-tap-investigation/implementation-steps.md` - Step-by-step guide\n- `sandbox/brew-tap-investigation/forge.rb.example` - Template formula\n\n**Tap repository started** (2025-11-20):\n- Repo: `github.com/jdillon/homebrew-planet57`\n- Tap name: `jdillon/planet57`\n- Formula: `Formula/forge.rb` - working draft\n- Approach: Installs to FORGE_HOME, symlinks bin\n- Current URL: local tarball for testing\n\n## Remaining work\n\n1. Switch formula from local tarball to GitHub release URL\n2. Tag v0.1.0 release and compute SHA256\n3. Test `brew tap jdillon/planet57 \u0026\u0026 brew install forge`\n4. Push tap repo to GitHub\n5. Update Forge README with installation instructions\n\n## Blockers\n\n1. ⚠️ Need stable release tagged (v0.1.0)\n2. ⚠️ Repos need to be made public first","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-26T02:24:37.548875-08:00","updated_at":"2025-11-27T01:14:15.079345-08:00","closed_at":"2025-11-27T01:14:15.079345-08:00","dependencies":[{"issue_id":"forge-e9g","depends_on_id":"forge-3ng","type":"blocks","created_at":"2025-11-26T02:26:54.282524-08:00","created_by":"daemon"}]}
{"id":"forge-efc","title":"Homebrew formula: implement FORGE_HOME bootstrap semantics","description":"Update the Homebrew formula to properly bootstrap ~/.forge structure instead of using Cellar-native installation.\n\n**Problem**: Current formula installs to libexec and creates a custom wrapper. This doesn't match Forge's architecture which expects FORGE_HOME=~/.forge with the full package installed there.\n\n**Solution**: Formula should replicate what bin/install.sh does:\n- Use `post_install` to escape Homebrew's sandbox\n- Bootstrap ~/.forge structure\n- Install package via `bun add` to ~/.forge/node_modules/\n- Symlink the existing bin/forge wrapper\n\n**Key constraint**: Forge is a single-user install by design. Homebrew is just the delivery mechanism - the actual installation lives in ~/.forge. See CLAUDE.md for details.\n\n**Acceptance Criteria**:\n- [ ] Formula uses post_install for ~/.forge bootstrap\n- [ ] Creates ~/.forge/{config,state,cache,logs} directories\n- [ ] Writes package.json, bunfig.toml to ~/.forge\n- [ ] Runs `bun add` to install package to ~/.forge/node_modules/\n- [ ] Symlinks existing bin/forge wrapper to Homebrew bin\n- [ ] `brew install jdillon/planet57/forge` works end-to-end\n- [ ] `forge --version` and `forge --help` work\n- [ ] release.yml updated with new formula template","design":"## Formula Structure\n\n### install block (sandboxed)\nStage tarball contents to libexec for Homebrew tracking:\n```ruby\ndef install\n  libexec.install Dir[\"*\"]\nend\n```\n\n### post_install block (outside sandbox)\nBootstrap ~/.forge and install package:\n```ruby\ndef post_install\n  forge_home = ENV[\"FORGE_HOME\"] || \"#{Dir.home}/.forge\"\n  \n  # 1. Create directory structure\n  system \"mkdir\", \"-p\", \n    \"#{forge_home}/config\",\n    \"#{forge_home}/state\", \n    \"#{forge_home}/cache\",\n    \"#{forge_home}/logs\"\n  \n  # 2. Write package.json\n  File.write(\"#{forge_home}/package.json\", \u003c\u003c~JSON)\n    {\n      \"name\": \"forge-meta\",\n      \"version\": \"1.0.0\",\n      \"private\": true\n    }\n  JSON\n  \n  # 3. Write bunfig.toml\n  File.write(\"#{forge_home}/bunfig.toml\", \u003c\u003c~TOML)\n    [install]\n    exact = true\n    dev = false\n    peer = true\n    optional = false\n    auto = \"disable\"\n  TOML\n  \n  # 4. Install package to forge_home\n  Dir.chdir(forge_home) do\n    system Formula[\"bun\"].opt_bin/\"bun\", \"add\", \"file://#{libexec}\"\n  end\n  \n  # 5. Symlink the wrapper\n  forge_bin = \"#{forge_home}/node_modules/@planet57/forge/bin/forge\"\n  bin.install_symlink forge_bin =\u003e \"forge\"\nend\n```\n\n### caveats\n```ruby\ndef caveats\n  \u003c\u003c~EOS\n    Forge installed to #{ENV[\"FORGE_HOME\"] || \"~/.forge\"}\n    \n    User data (config, plugins, state) persists across upgrades.\n  EOS\nend\n```\n\n## Release workflow update\n\nThe release.yml needs to generate this formula template instead of the current libexec version.\n\n## Testing\n\n```bash\nbrew uninstall forge\nbrew untap jdillon/planet57\nbrew tap jdillon/planet57\nbrew install jdillon/planet57/forge\nforge --version\n```","notes":"post_install is ALSO sandboxed on macOS - cannot write to ~/.forge. Need alternative approach:\n\nOption 1: Caveats + manual setup command\n- Formula installs to libexec\n- User runs `brew postinstall forge` or `forge-setup` manually after install\n- Or: first run of `forge` bootstraps itself\n\nOption 2: Wrapper script bootstraps on first run\n- bin/forge wrapper checks if ~/.forge exists\n- If not, runs bootstrap before continuing\n- Transparent to user","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T01:14:43.40734-08:00","updated_at":"2025-11-27T16:26:54.758713-08:00","closed_at":"2025-11-27T16:26:54.758713-08:00"}
{"id":"forge-eny","title":"Release command and workflow automation","description":"Create a release workflow that can be triggered via GitHub UI button or forge CLI command.\n\n**Goals:**\n- One-click release from GitHub Actions UI\n- Optional: `forge release` CLI command for local triggering\n- Auto-tag based on package.json version\n- Post-release: bump version and commit","design":"## Option A: GitHub Actions Manual Dispatch (Recommended)\n\n`workflow_dispatch` allows triggering from GitHub UI with optional inputs:\n\n```yaml\non:\n  workflow_dispatch:\n    inputs:\n      bump:\n        description: 'Version bump type'\n        required: true\n        default: 'patch'\n        type: choice\n        options: [patch, minor, major]\n\njobs:\n  release:\n    steps:\n      - Checkout\n      - Read version from package.json\n      - Create and push tag\n      - (release.yml triggers on tag, does the rest)\n      \n  post-release:\n    needs: release\n    steps:\n      - Bump version in package.json\n      - Commit \"chore: bump version to X.Y.Z\"\n      - Push to main\n```\n\n**UI**: Actions tab → \"Release\" workflow → \"Run workflow\" button → Select bump type → Go\n\n## Option B: Forge CLI Command\n\n```bash\nforge release [patch|minor|major]\n```\n\n- Reads current version from package.json\n- Creates git tag\n- Pushes tag (triggers release.yml)\n- Bumps version locally\n- Commits and pushes\n\n## Recommendation\n\nStart with Option A (workflow_dispatch) - no code needed, just YAML. Add CLI command later if wanted.","acceptance_criteria":"- [ ] Can trigger release from GitHub Actions UI\n- [ ] Workflow creates tag from package.json version\n- [ ] release.yml triggers and creates GitHub release\n- [ ] Version bumped and committed post-release\n- [ ] Works for patch/minor/major bumps","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-26T23:08:28.569302-08:00","updated_at":"2025-11-27T01:14:14.985577-08:00","closed_at":"2025-11-27T01:14:14.985577-08:00"}
{"id":"forge-eua","title":"Shell completion support (bash/zsh/fish)","description":"Add shell completion for commands, options, and arguments.\n\n**Library**: `omelette` (already installed)\n\n**Features needed**:\n- Auto-complete commands and subcommands\n- Auto-complete options (--help, --debug, etc.)\n- Auto-complete command-specific arguments\n- Generate completion scripts for bash/zsh/fish","design":"Use `omelette` library to generate completion scripts.\n\n```typescript\nimport omelette from 'omelette';\n\nconst completion = omelette('forge \u003ccommand\u003e \u003csubcommand\u003e');\n\ncompletion.on('command', ({ reply }) =\u003e {\n  reply(['website', 'basic', 'help', 'version']);\n});\n\ncompletion.on('subcommand', ({ before, reply }) =\u003e {\n  if (before === 'website') {\n    reply(['build', 'deploy', 'status']);\n  }\n});\n\ncompletion.init();\n```\n\n**Installation**: `forge completion install` to add to shell profile.","acceptance_criteria":"- [ ] `forge completion` command exists\n- [ ] `forge completion install` adds to shell profile\n- [ ] Tab-completes top-level commands\n- [ ] Tab-completes subcommands within groups\n- [ ] Tab-completes global options\n- [ ] Works in bash, zsh, fish","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-26T15:23:00.83981-08:00","updated_at":"2025-11-26T15:23:00.83981-08:00"}
{"id":"forge-kxw","title":"Automate Homebrew formula updates on release","description":"Automate the Homebrew tap update process when releasing new versions. Currently manual: rebuild tarball, compute sha256, update formula, push to tap.\n\n**Reference**: beads project `.github/workflows/update-homebrew.yml`","design":"## Approach\n\n**Phase 1**: Automate current approach (Bun tarball)\n- Tag push (v*) triggers release workflow\n- Build tarball, create GitHub release\n- Compute sha256, generate formula, push to tap\n- Low effort, matches current manual process\n\n**Phase 2** (future): Standalone binary via `bun build --compile`\n- Zero-dependency binaries for darwin-arm64, darwin-x64, linux-x64\n- Better UX but larger binaries (~50MB)\n\n## Implementation\n\n### release.yml workflow\n```yaml\non:\n  push:\n    tags: ['v*']\n\njobs:\n  release:\n    steps:\n      - uses: actions/checkout@v4\n      - uses: oven-sh/setup-bun@v2\n      - run: bun run pack\n      - uses: softprops/action-gh-release@v1\n        with:\n          files: build/*.tgz\n\n  update-homebrew:\n    needs: release\n    steps:\n      - Download tarball, compute sha256\n      - Generate formula from template\n      - Clone tap repo using HOMEBREW_TAP_TOKEN\n      - Commit and push updated formula\n```\n\n### Formula template\n```ruby\nclass Forge \u003c Formula\n  url \"https://github.com/jdillon/forge/releases/download/v{{VERSION}}/planet57-forge-{{VERSION}}.tgz\"\n  sha256 \"{{SHA256}}\"\n  version \"{{VERSION}}\"\n  depends_on \"oven-sh/bun/bun\"\n  # ...\nend\n```\n\n### Secrets required\n- `HOMEBREW_TAP_TOKEN`: PAT with `repo` scope for pushing to homebrew-planet57","acceptance_criteria":"- [ ] `.github/workflows/release.yml` created\n- [ ] Formula template with placeholders\n- [ ] `HOMEBREW_TAP_TOKEN` secret configured\n- [ ] Tag push triggers release + formula update\n- [ ] `brew upgrade forge` works after release\n- [ ] Manual dispatch option for testing","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-26T13:53:13.833881-08:00","updated_at":"2025-11-26T13:53:13.833881-08:00","dependencies":[{"issue_id":"forge-kxw","depends_on_id":"forge-3ng","type":"blocks","created_at":"2025-11-26T13:53:20.515362-08:00","created_by":"daemon"}]}
{"id":"forge-mvj","title":"ExitNotification stack trace shown on unknown command","description":"Running forge with an unknown command displays the error message correctly, but then shows an ugly `ExitNotification` stack trace that shouldn't be visible to users.\n\n**Repro**: `forge foo` (any unknown command)\n\n**Actual**:\n```\nerror: too many arguments. Expected 0 arguments but got 1.\nERROR: unknown command. Run 'forge --help' to see available commands\nTry 'forge --help' for more information.\n44 | /**\n45 |  * Exit process with code (clean exit)\n...\nExitNotification: Exit with code 1\n exitCode: 1,\n      at exit (~/.forge/node_modules/@planet57/forge/lib/helpers.ts:49:9)\n      ...\n```\n\n**Expected**: Just the error message, no stack trace. `ExitNotification` is internal control flow, not a user-facing error.","design":"`ExitNotification` is thrown as a clean exit mechanism but Bun is printing the stack trace. Need to ensure it's caught at the top level and handled silently (just exit with the code).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-26T02:21:58.105051-08:00","updated_at":"2025-11-28T00:33:42.1511-08:00","closed_at":"2025-11-28T00:33:42.1511-08:00"}
{"id":"forge-sua","title":"Native nested subcommands support","description":"Currently forge supports one level of command grouping via modules (`forge \u003cgroup\u003e \u003ccommand\u003e`), but no native support for nested subcommands (`forge \u003cgroup\u003e \u003csubgroup\u003e \u003ccommand\u003e`).\n\n**Current workaround**: Switch statement on positional argument (Style 9)\n\n**Downsides of workaround**:\n- No automatic help for sub-actions\n- Manual validation and error messages\n- Can't define per-action options/arguments cleanly\n\n**Use cases**:\n- `forge ios sim list|boot|shutdown`\n- `forge db migrate up|down|status`\n- `forge k8s pod list|logs|exec`","design":"## Proposed API\n\nAdd `subcommands` property to `ForgeCommand`:\n\n```typescript\n// lib/types.ts\nexport interface ForgeCommand {\n  description: string;\n  subcommands?: Record\u003cstring, ForgeCommand\u003e;  // NEW\n  defineCommand?: (cmd: Command) =\u003e void;\n  execute?: (...) =\u003e Promise\u003cvoid\u003e;  // optional if has subcommands\n}\n```\n\n**Usage**:\n```typescript\nexport const sim: ForgeCommand = {\n  description: 'iOS simulator commands',\n  subcommands: {\n    list: {\n      description: 'List available simulators',\n      execute: async () =\u003e { /* ... */ }\n    },\n    boot: {\n      description: 'Boot simulator',\n      defineCommand: (cmd) =\u003e cmd.argument('[name]', 'Simulator name'),\n      execute: async (opts, args) =\u003e { /* ... */ }\n    }\n  }\n};\n```\n\n**Result**:\n```\n$ forge ios sim --help\nCommands:\n  list      List available simulators\n  boot      Boot simulator\n```\n\n## Implementation Notes\n\n1. **core.ts**: Check for `subcommands` and recursively build Commander subcommands via `cmd.addCommand()`\n2. **Depth limit**: Consider 2-3 levels max\n3. **Execute behavior**: If has `subcommands` but no `execute`, show help when invoked without subcommand","acceptance_criteria":"- [ ] `subcommands` property added to ForgeCommand type\n- [ ] core.ts recursively registers nested subcommands\n- [ ] `--help` shows subcommand list properly\n- [ ] Per-subcommand options/arguments work\n- [ ] Depth limit enforced (2-3 levels)\n- [ ] Commands without execute show help when invoked alone\n- [ ] Example added to examples/","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-26T02:28:12.126037-08:00","updated_at":"2025-11-26T02:28:12.126037-08:00"}
